{"id":"a7BU","dependencies":[{"name":"/project/deck-gl-examples-01/node_modules/@loaders.gl/core/dist/esm/iterators/make-iterator/make-stream-iterator.js.map","includedInParent":true,"mtime":1688284130527},{"name":"/project/deck-gl-examples-01/package.json","includedInParent":true,"mtime":1688495957541},{"name":"/project/deck-gl-examples-01/node_modules/@loaders.gl/core/package.json","includedInParent":true,"mtime":1688284130527},{"name":"@loaders.gl/loader-utils","loc":{"line":1,"column":41,"index":41},"parent":"/project/deck-gl-examples-01/node_modules/@loaders.gl/core/dist/esm/iterators/make-iterator/make-stream-iterator.js","resolved":"/project/deck-gl-examples-01/node_modules/@loaders.gl/loader-utils/dist/esm/index.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.makeStreamIterator=r;var e=require(\"@loaders.gl/loader-utils\");function r(r,o){return e.isBrowser?t(r,o):a(r,o)}async function*t(r,t){const a=r.getReader();let o;try{for(;;){const r=o||a.read();null!=t&&t._streamReadAhead&&(o=a.read());const{done:n,value:s}=await r;if(n)return;yield(0,e.toArrayBuffer)(s)}}catch(n){a.releaseLock()}}async function*a(r,t){for await(const a of r)yield(0,e.toArrayBuffer)(a)}"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":13}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":20}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":35}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":43}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":56}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":57}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":64}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":68}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":76}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":1,"column":95}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":97}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":101}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":103}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":111}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":12,"column":7},"generated":{"line":1,"column":139}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeStreamIterator","original":{"line":12,"column":16},"generated":{"line":1,"column":148}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":13,"column":2},"generated":{"line":1,"column":150}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":14,"column":2},"generated":{"line":1,"column":152}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":155}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"isBrowser","original":{"line":16,"column":9},"generated":{"line":1,"column":162}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":16,"column":18},"generated":{"line":1,"column":164}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeBrowserStreamIterator","original":{"line":17,"column":6},"generated":{"line":1,"column":174}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":17,"column":32},"generated":{"line":1,"column":176}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":17,"column":58},"generated":{"line":1,"column":178}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeNodeStreamIterator","original":{"line":18,"column":6},"generated":{"line":1,"column":181}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":18,"column":29},"generated":{"line":1,"column":183}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":18,"column":49},"generated":{"line":1,"column":185}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":188}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeBrowserStreamIterator","original":{"line":26,"column":16},"generated":{"line":1,"column":203}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":27,"column":2},"generated":{"line":1,"column":205}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":28,"column":2},"generated":{"line":1,"column":207}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":1,"column":210}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":39,"column":8},"generated":{"line":1,"column":216}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":39,"column":17},"generated":{"line":1,"column":218}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"getReader","original":{"line":39,"column":24},"generated":{"line":1,"column":220}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":41,"column":2},"generated":{"line":1,"column":232}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":41,"column":6},"generated":{"line":1,"column":236}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":1,"column":238}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":4},"generated":{"line":1,"column":242}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":17},"generated":{"line":1,"column":249}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":1,"column":250}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"currentBatchPromise","original":{"line":46,"column":12},"generated":{"line":1,"column":256}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":46,"column":34},"generated":{"line":1,"column":258}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":46,"column":54},"generated":{"line":1,"column":261}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"read","original":{"line":46,"column":61},"generated":{"line":1,"column":263}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":1,"column":270}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":1,"column":276}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":1,"column":279}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"_streamReadAhead","original":{"line":49,"column":19},"generated":{"line":1,"column":281}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":50,"column":8},"generated":{"line":1,"column":300}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":50,"column":27},"generated":{"line":1,"column":302}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"read","original":{"line":50,"column":34},"generated":{"line":1,"column":304}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":6},"generated":{"line":1,"column":312}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":12},"generated":{"line":1,"column":318}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"done","original":{"line":54,"column":13},"generated":{"line":1,"column":323}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":17},"generated":{"line":1,"column":325}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"value","original":{"line":54,"column":19},"generated":{"line":1,"column":331}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"currentBatchPromise","original":{"line":54,"column":34},"generated":{"line":1,"column":340}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":56,"column":6},"generated":{"line":1,"column":342}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"done","original":{"line":56,"column":10},"generated":{"line":1,"column":345}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":57,"column":8},"generated":{"line":1,"column":347}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":60,"column":12},"generated":{"line":1,"column":360}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":60,"column":12},"generated":{"line":1,"column":362}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":60,"column":25},"generated":{"line":1,"column":364}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"value","original":{"line":60,"column":26},"generated":{"line":1,"column":379}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":1,"column":383}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"error","original":{"line":62,"column":11},"generated":{"line":1,"column":389}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":65,"column":4},"generated":{"line":1,"column":392}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"releaseLock","original":{"line":65,"column":11},"generated":{"line":1,"column":394}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":74,"column":0},"generated":{"line":1,"column":409}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeNodeStreamIterator","original":{"line":74,"column":16},"generated":{"line":1,"column":424}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":75,"column":2},"generated":{"line":1,"column":426}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":76,"column":2},"generated":{"line":1,"column":428}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":2},"generated":{"line":1,"column":431}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":13},"generated":{"line":1,"column":441}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"chunk","original":{"line":80,"column":19},"generated":{"line":1,"column":447}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":80,"column":28},"generated":{"line":1,"column":452}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":81,"column":10},"generated":{"line":1,"column":460}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":81,"column":10},"generated":{"line":1,"column":462}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":81,"column":23},"generated":{"line":1,"column":464}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"chunk","original":{"line":81,"column":24},"generated":{"line":1,"column":479}}],"sources":{"../../../../src/iterators/make-iterator/make-stream-iterator.ts":"import type {Readable} from 'stream';\nimport {isBrowser, toArrayBuffer} from '@loaders.gl/loader-utils';\n\nexport type StreamIteratorOptions = {\n  _streamReadAhead?: boolean;\n};\n\n/**\n * Returns an async iterable that reads from a stream (works in both Node.js and browsers)\n * @param stream stream to iterator over\n */\nexport function makeStreamIterator(\n  stream: ReadableStream | Readable,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  return isBrowser\n    ? makeBrowserStreamIterator(stream as ReadableStream, options)\n    : makeNodeStreamIterator(stream as Readable, options);\n}\n\n/**\n * Returns an async iterable that reads from a DOM (browser) stream\n * @param stream stream to iterate from\n * @see https://jakearchibald.com/2017/async-iterators-and-generators/#making-streams-iterate\n */\nasync function* makeBrowserStreamIterator(\n  stream: ReadableStream,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  // WhatWG: stream is supposed to have a `getIterator` method\n  // if (typeof stream.getIterator === 'function') {\n  //   return stream.getIterator();\n  // }\n  // if (typeof stream[Symbol.asyncIterator] === 'function') {\n  //   return makeToArrayBufferIterator(stream);\n  // }\n\n  // In the browser, we first need to get a lock on the stream\n  const reader = stream.getReader();\n\n  let nextBatchPromise: Promise<{done?: boolean; value?: Uint8Array}> | undefined;\n\n  try {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const currentBatchPromise = nextBatchPromise || reader.read();\n      // Issue a read for an additional batch, while we await the next batch\n      // Idea is to make fetching happen in parallel with processing / parsing\n      if (options?._streamReadAhead) {\n        nextBatchPromise = reader.read();\n      }\n      // Read from the stream\n      // value is a Uint8Array\n      const {done, value} = await currentBatchPromise;\n      // Exit if we're done\n      if (done) {\n        return;\n      }\n      // Else yield the chunk\n      yield toArrayBuffer(value);\n    }\n  } catch (error) {\n    // TODO - examples makes it look like this should always be called,\n    // but that generates exceptions so only call it if we do not reach the end\n    reader.releaseLock();\n  }\n}\n\n/**\n * Returns an async iterable that reads from a DOM (browser) stream\n * @param stream stream to iterate from\n * @note Requires Node.js >= 10\n */\nasync function* makeNodeStreamIterator(\n  stream: Readable,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  // Hacky test for node version to ensure we don't call bad polyfills\n  // NODE 10+: stream is an asyncIterator\n  for await (const chunk of stream) {\n    yield toArrayBuffer(chunk); // Coerce each chunk to ArrayBuffer\n  }\n}\n/* TODO - remove NODE < 10\n * @see https://github.com/bustle/streaming-iterables, MIT license\n *\n  if (typeof stream[Symbol.asyncIterator] === 'function') {\n    return;\n  }\n\n  // TODO - check if is this ever used in Node 10+?\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const data = stream.read();\n    if (data !== null) {\n      yield toArrayBuffer(data);\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (stream._readableState?.ended) {\n      return;\n    }\n    await onceReadable(stream);\n  }\n\nasync function onceReadable(stream: Readable): Promise<any> {\n  return new Promise((resolve) => {\n    stream.once('readable', resolve);\n  });\n}\n  */\n"},"lineCount":null}},"error":null,"hash":"40ccda021fd578877633e0aef054f6d9","cacheData":{"env":{}}}