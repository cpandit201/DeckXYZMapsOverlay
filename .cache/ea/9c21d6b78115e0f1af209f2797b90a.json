{"id":"node_modules/@loaders.gl/core/dist/esm/iterators/make-iterator/make-stream-iterator.js","dependencies":[{"name":"/project/home/cpandit201/workspace/node_modules/@loaders.gl/core/dist/esm/iterators/make-iterator/make-stream-iterator.js.map","includedInParent":true,"mtime":1688275022253},{"name":"/project/home/cpandit201/workspace/package.json","includedInParent":true,"mtime":1688277495169},{"name":"/project/home/cpandit201/workspace/node_modules/@loaders.gl/core/package.json","includedInParent":true,"mtime":1688275022253},{"name":"@loaders.gl/loader-utils","loc":{"line":1,"column":41,"index":41},"parent":"/project/home/cpandit201/workspace/node_modules/@loaders.gl/core/dist/esm/iterators/make-iterator/make-stream-iterator.js","resolved":"/project/home/cpandit201/workspace/node_modules/@loaders.gl/loader-utils/dist/esm/index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeStreamIterator = makeStreamIterator;\nvar _loaderUtils = require(\"@loaders.gl/loader-utils\");\nfunction makeStreamIterator(stream, options) {\n  return _loaderUtils.isBrowser ? makeBrowserStreamIterator(stream, options) : makeNodeStreamIterator(stream, options);\n}\nasync function* makeBrowserStreamIterator(stream, options) {\n  const reader = stream.getReader();\n  let nextBatchPromise;\n  try {\n    while (true) {\n      const currentBatchPromise = nextBatchPromise || reader.read();\n      if (options !== null && options !== void 0 && options._streamReadAhead) {\n        nextBatchPromise = reader.read();\n      }\n      const {\n        done,\n        value\n      } = await currentBatchPromise;\n      if (done) {\n        return;\n      }\n      yield (0, _loaderUtils.toArrayBuffer)(value);\n    }\n  } catch (error) {\n    reader.releaseLock();\n  }\n}\nasync function* makeNodeStreamIterator(stream, options) {\n  for await (const chunk of stream) {\n    yield (0, _loaderUtils.toArrayBuffer)(chunk);\n  }\n}"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":19}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":26}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":12,"column":7},"generated":{"line":8,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeStreamIterator","original":{"line":12,"column":16},"generated":{"line":8,"column":9}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeStreamIterator","original":{"line":12,"column":34},"generated":{"line":8,"column":27}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":13,"column":2},"generated":{"line":8,"column":28}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":13,"column":35},"generated":{"line":8,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":14,"column":2},"generated":{"line":8,"column":36}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":14,"column":33},"generated":{"line":8,"column":43}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":15,"column":30},"generated":{"line":8,"column":45}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":9,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"isBrowser","original":{"line":16,"column":9},"generated":{"line":9,"column":9}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":16,"column":18},"generated":{"line":9,"column":31}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeBrowserStreamIterator","original":{"line":17,"column":6},"generated":{"line":9,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":17,"column":31},"generated":{"line":9,"column":59}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":17,"column":32},"generated":{"line":9,"column":60}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":17,"column":38},"generated":{"line":9,"column":66}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":17,"column":58},"generated":{"line":9,"column":68}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":17,"column":65},"generated":{"line":9,"column":75}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":17,"column":66},"generated":{"line":9,"column":76}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeNodeStreamIterator","original":{"line":18,"column":6},"generated":{"line":9,"column":79}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":18,"column":28},"generated":{"line":9,"column":101}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":18,"column":29},"generated":{"line":9,"column":102}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":18,"column":35},"generated":{"line":9,"column":108}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":18,"column":49},"generated":{"line":9,"column":110}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":18,"column":56},"generated":{"line":9,"column":117}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":18,"column":57},"generated":{"line":9,"column":118}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":19,"column":0},"generated":{"line":10,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":11,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeBrowserStreamIterator","original":{"line":26,"column":16},"generated":{"line":11,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeBrowserStreamIterator","original":{"line":26,"column":41},"generated":{"line":11,"column":41}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":27,"column":2},"generated":{"line":11,"column":42}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":27,"column":24},"generated":{"line":11,"column":48}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":28,"column":2},"generated":{"line":11,"column":50}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":28,"column":33},"generated":{"line":11,"column":57}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":29,"column":30},"generated":{"line":11,"column":59}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":12,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":39,"column":8},"generated":{"line":12,"column":8}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":14},"generated":{"line":12,"column":14}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":39,"column":17},"generated":{"line":12,"column":17}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":12,"column":23}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"getReader","original":{"line":39,"column":24},"generated":{"line":12,"column":24}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":33},"generated":{"line":12,"column":33}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":34},"generated":{"line":12,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":39,"column":35},"generated":{"line":12,"column":35}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":41,"column":2},"generated":{"line":13,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":41,"column":6},"generated":{"line":13,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":41,"column":81},"generated":{"line":13,"column":22}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":14,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":43,"column":6},"generated":{"line":14,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":4},"generated":{"line":15,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":11},"generated":{"line":15,"column":11}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":15},"generated":{"line":15,"column":15}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":45,"column":17},"generated":{"line":15,"column":17}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":16,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"currentBatchPromise","original":{"line":46,"column":12},"generated":{"line":16,"column":12}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":31},"generated":{"line":16,"column":31}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":46,"column":34},"generated":{"line":16,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":50},"generated":{"line":16,"column":50}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":46,"column":54},"generated":{"line":16,"column":54}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":60},"generated":{"line":16,"column":60}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"read","original":{"line":46,"column":61},"generated":{"line":16,"column":61}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":65},"generated":{"line":16,"column":65}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":66},"generated":{"line":16,"column":66}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":46,"column":67},"generated":{"line":16,"column":67}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":6},"generated":{"line":17,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":17,"column":10}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":17}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":22}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":26}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":17,"column":30}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":37}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":42}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":47}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":48}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":49,"column":10},"generated":{"line":17,"column":52}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":17},"generated":{"line":17,"column":59}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"_streamReadAhead","original":{"line":49,"column":19},"generated":{"line":17,"column":60}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":35},"generated":{"line":17,"column":76}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":49,"column":37},"generated":{"line":17,"column":78}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"nextBatchPromise","original":{"line":50,"column":8},"generated":{"line":18,"column":8}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":50,"column":24},"generated":{"line":18,"column":24}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":50,"column":27},"generated":{"line":18,"column":27}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":50,"column":33},"generated":{"line":18,"column":33}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"read","original":{"line":50,"column":34},"generated":{"line":18,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":50,"column":38},"generated":{"line":18,"column":38}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":50,"column":39},"generated":{"line":18,"column":39}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":50,"column":40},"generated":{"line":18,"column":40}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":51,"column":6},"generated":{"line":19,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":6},"generated":{"line":20,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":12},"generated":{"line":20,"column":12}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"done","original":{"line":54,"column":13},"generated":{"line":21,"column":8}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":17},"generated":{"line":21,"column":12}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"value","original":{"line":54,"column":19},"generated":{"line":22,"column":8}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":24},"generated":{"line":23,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":25},"generated":{"line":23,"column":7}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":28},"generated":{"line":23,"column":10}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"currentBatchPromise","original":{"line":54,"column":34},"generated":{"line":23,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":54,"column":53},"generated":{"line":23,"column":35}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":56,"column":6},"generated":{"line":24,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"done","original":{"line":56,"column":10},"generated":{"line":24,"column":10}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":56,"column":14},"generated":{"line":24,"column":14}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":56,"column":16},"generated":{"line":24,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":57,"column":8},"generated":{"line":25,"column":8}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":58,"column":6},"generated":{"line":26,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":60,"column":6},"generated":{"line":27,"column":6}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":60,"column":12},"generated":{"line":27,"column":12}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":60,"column":12},"generated":{"line":27,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":60,"column":25},"generated":{"line":27,"column":42}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"value","original":{"line":60,"column":26},"generated":{"line":27,"column":44}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":60,"column":31},"generated":{"line":27,"column":49}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":60,"column":32},"generated":{"line":27,"column":50}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":61,"column":4},"generated":{"line":28,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":2},"generated":{"line":29,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":3},"generated":{"line":29,"column":3}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":29,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"error","original":{"line":62,"column":11},"generated":{"line":29,"column":11}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":16},"generated":{"line":29,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":62,"column":18},"generated":{"line":29,"column":18}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"reader","original":{"line":65,"column":4},"generated":{"line":30,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":65,"column":10},"generated":{"line":30,"column":10}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"releaseLock","original":{"line":65,"column":11},"generated":{"line":30,"column":11}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":65,"column":22},"generated":{"line":30,"column":22}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":65,"column":23},"generated":{"line":30,"column":23}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":65,"column":24},"generated":{"line":30,"column":24}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":66,"column":2},"generated":{"line":31,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":67,"column":0},"generated":{"line":32,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":74,"column":0},"generated":{"line":33,"column":0}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeNodeStreamIterator","original":{"line":74,"column":16},"generated":{"line":33,"column":16}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"makeNodeStreamIterator","original":{"line":74,"column":38},"generated":{"line":33,"column":38}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":75,"column":2},"generated":{"line":33,"column":39}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":75,"column":18},"generated":{"line":33,"column":45}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"options","original":{"line":76,"column":2},"generated":{"line":33,"column":47}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":76,"column":33},"generated":{"line":33,"column":54}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":77,"column":30},"generated":{"line":33,"column":56}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":2},"generated":{"line":34,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":13},"generated":{"line":34,"column":13}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"chunk","original":{"line":80,"column":19},"generated":{"line":34,"column":19}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":24},"generated":{"line":34,"column":24}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"stream","original":{"line":80,"column":28},"generated":{"line":34,"column":28}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":34},"generated":{"line":34,"column":34}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":80,"column":36},"generated":{"line":34,"column":36}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":81,"column":4},"generated":{"line":35,"column":4}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":81,"column":10},"generated":{"line":35,"column":10}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"toArrayBuffer","original":{"line":81,"column":10},"generated":{"line":35,"column":14}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":81,"column":23},"generated":{"line":35,"column":40}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":"chunk","original":{"line":81,"column":24},"generated":{"line":35,"column":42}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":81,"column":29},"generated":{"line":35,"column":47}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":81,"column":30},"generated":{"line":35,"column":48}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":82,"column":2},"generated":{"line":36,"column":2}},{"source":"../../../../src/iterators/make-iterator/make-stream-iterator.ts","name":null,"original":{"line":83,"column":0},"generated":{"line":37,"column":0}}],"sources":{"../../../../src/iterators/make-iterator/make-stream-iterator.ts":"import type {Readable} from 'stream';\nimport {isBrowser, toArrayBuffer} from '@loaders.gl/loader-utils';\n\nexport type StreamIteratorOptions = {\n  _streamReadAhead?: boolean;\n};\n\n/**\n * Returns an async iterable that reads from a stream (works in both Node.js and browsers)\n * @param stream stream to iterator over\n */\nexport function makeStreamIterator(\n  stream: ReadableStream | Readable,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  return isBrowser\n    ? makeBrowserStreamIterator(stream as ReadableStream, options)\n    : makeNodeStreamIterator(stream as Readable, options);\n}\n\n/**\n * Returns an async iterable that reads from a DOM (browser) stream\n * @param stream stream to iterate from\n * @see https://jakearchibald.com/2017/async-iterators-and-generators/#making-streams-iterate\n */\nasync function* makeBrowserStreamIterator(\n  stream: ReadableStream,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  // WhatWG: stream is supposed to have a `getIterator` method\n  // if (typeof stream.getIterator === 'function') {\n  //   return stream.getIterator();\n  // }\n  // if (typeof stream[Symbol.asyncIterator] === 'function') {\n  //   return makeToArrayBufferIterator(stream);\n  // }\n\n  // In the browser, we first need to get a lock on the stream\n  const reader = stream.getReader();\n\n  let nextBatchPromise: Promise<{done?: boolean; value?: Uint8Array}> | undefined;\n\n  try {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const currentBatchPromise = nextBatchPromise || reader.read();\n      // Issue a read for an additional batch, while we await the next batch\n      // Idea is to make fetching happen in parallel with processing / parsing\n      if (options?._streamReadAhead) {\n        nextBatchPromise = reader.read();\n      }\n      // Read from the stream\n      // value is a Uint8Array\n      const {done, value} = await currentBatchPromise;\n      // Exit if we're done\n      if (done) {\n        return;\n      }\n      // Else yield the chunk\n      yield toArrayBuffer(value);\n    }\n  } catch (error) {\n    // TODO - examples makes it look like this should always be called,\n    // but that generates exceptions so only call it if we do not reach the end\n    reader.releaseLock();\n  }\n}\n\n/**\n * Returns an async iterable that reads from a DOM (browser) stream\n * @param stream stream to iterate from\n * @note Requires Node.js >= 10\n */\nasync function* makeNodeStreamIterator(\n  stream: Readable,\n  options?: StreamIteratorOptions\n): AsyncIterable<ArrayBuffer> {\n  // Hacky test for node version to ensure we don't call bad polyfills\n  // NODE 10+: stream is an asyncIterator\n  for await (const chunk of stream) {\n    yield toArrayBuffer(chunk); // Coerce each chunk to ArrayBuffer\n  }\n}\n/* TODO - remove NODE < 10\n * @see https://github.com/bustle/streaming-iterables, MIT license\n *\n  if (typeof stream[Symbol.asyncIterator] === 'function') {\n    return;\n  }\n\n  // TODO - check if is this ever used in Node 10+?\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const data = stream.read();\n    if (data !== null) {\n      yield toArrayBuffer(data);\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (stream._readableState?.ended) {\n      return;\n    }\n    await onceReadable(stream);\n  }\n\nasync function onceReadable(stream: Readable): Promise<any> {\n  return new Promise((resolve) => {\n    stream.once('readable', resolve);\n  });\n}\n  */\n"},"lineCount":null}},"error":null,"hash":"519a8dafa38967f8eb244e9e9ad61059","cacheData":{"env":{}}}