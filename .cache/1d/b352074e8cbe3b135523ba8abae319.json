{"id":"sqcc","dependencies":[{"name":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js.map","includedInParent":true,"mtime":1688284130514},{"name":"/project/deck-gl-examples-01/package.json","includedInParent":true,"mtime":1688495957541},{"name":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/package.json","includedInParent":true,"mtime":1688284130514},{"name":"@babel/runtime/helpers/esm/defineProperty","loc":{"line":1,"column":28,"index":28},"parent":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js","resolved":"/project/deck-gl-examples-01/node_modules/@babel/runtime/helpers/esm/defineProperty.js"},{"name":"../utils/deep-equal","loc":{"line":2,"column":26,"index":99},"parent":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js","resolved":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/utils/deep-equal.js"},{"name":"../effects/lighting/lighting-effect","loc":{"line":3,"column":27,"index":149},"parent":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js","resolved":"/project/deck-gl-examples-01/node_modules/@deck.gl/core/dist/esm/effects/lighting/lighting-effect.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=f(require(\"@babel/runtime/helpers/esm/defineProperty\")),t=require(\"../utils/deep-equal\"),s=f(require(\"../effects/lighting/lighting-effect\"));function f(e){return e&&e.__esModule?e:{default:e}}const i=new s.default;function d(e,t){var s,f;return(null!==(s=e.order)&&void 0!==s?s:1/0)-(null!==(f=t.order)&&void 0!==f?f:1/0)}class r{constructor(){(0,e.default)(this,\"effects\",void 0),(0,e.default)(this,\"_resolvedEffects\",[]),(0,e.default)(this,\"_defaultEffects\",[]),(0,e.default)(this,\"_needsRedraw\",void 0),this.effects=[],this._needsRedraw=\"Initial render\",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const s=t.findIndex(t=>d(t,e)>0);s<0?t.push(e):t.splice(s,0,e),this._setEffects(this.effects)}}setProps(e){\"effects\"in e&&((0,t.deepEqual)(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const f=[];for(const s of e){const e=t[s.id];e&&e!==s?e.setProps?(e.setProps(s.props),f.push(e)):(e.cleanup(),f.push(s)):f.push(s),delete t[s.id]}for(const s in t)t[s].cleanup();this.effects=f,this._resolvedEffects=f.concat(this._defaultEffects),e.some(e=>e instanceof s.default)||this._resolvedEffects.push(i),this._needsRedraw=\"effects changed\"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}exports.default=r;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":0}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":13}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":20}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":35}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":43}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":56}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":57}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":64}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":68}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":76}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":89}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":91}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":95}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":97}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":99}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":107}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":153}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":155}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":163}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":186}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":188}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":190}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":198}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":238}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":247}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":249}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":252}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":259}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":262}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":264}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":275}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":277}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":278}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":286}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":289}},{"source":"../../../src/lib/effect-manager.ts","name":"DEFAULT_LIGHTING_EFFECT","original":{"line":5,"column":6},"generated":{"line":1,"column":295}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":5,"column":32},"generated":{"line":1,"column":297}},{"source":"../../../src/lib/effect-manager.ts","name":"LightingEffect","original":{"line":5,"column":36},"generated":{"line":1,"column":301}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":5,"column":32},"generated":{"line":1,"column":303}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":1,"column":311}},{"source":"../../../src/lib/effect-manager.ts","name":"compareEffects","original":{"line":8,"column":9},"generated":{"line":1,"column":320}},{"source":"../../../src/lib/effect-manager.ts","name":"e1","original":{"line":8,"column":24},"generated":{"line":1,"column":322}},{"source":"../../../src/lib/effect-manager.ts","name":"e2","original":{"line":8,"column":36},"generated":{"line":1,"column":324}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":8,"column":56},"generated":{"line":1,"column":327}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":8,"column":56},"generated":{"line":1,"column":331}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":8,"column":56},"generated":{"line":1,"column":333}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":11,"column":2},"generated":{"line":1,"column":335}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":342}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":350}},{"source":"../../../src/lib/effect-manager.ts","name":"e1","original":{"line":9,"column":13},"generated":{"line":1,"column":352}},{"source":"../../../src/lib/effect-manager.ts","name":"order","original":{"line":9,"column":16},"generated":{"line":1,"column":354}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":367}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":371}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":373}},{"source":"../../../src/lib/effect-manager.ts","name":"Infinity","original":{"line":9,"column":25},"generated":{"line":1,"column":375}},{"source":"../../../src/lib/effect-manager.ts","name":"Infinity","original":{"line":9,"column":25},"generated":{"line":1,"column":377}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":381}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":389}},{"source":"../../../src/lib/effect-manager.ts","name":"e2","original":{"line":10,"column":13},"generated":{"line":1,"column":391}},{"source":"../../../src/lib/effect-manager.ts","name":"order","original":{"line":10,"column":16},"generated":{"line":1,"column":393}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":406}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":410}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":10,"column":10},"generated":{"line":1,"column":412}},{"source":"../../../src/lib/effect-manager.ts","name":"Infinity","original":{"line":10,"column":25},"generated":{"line":1,"column":414}},{"source":"../../../src/lib/effect-manager.ts","name":"Infinity","original":{"line":10,"column":25},"generated":{"line":1,"column":416}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":15},"generated":{"line":1,"column":419}},{"source":"../../../src/lib/effect-manager.ts","name":"EffectManager","original":{"line":14,"column":21},"generated":{"line":1,"column":425}},{"source":"../../../src/lib/effect-manager.ts","name":"constructor","original":{"line":21,"column":2},"generated":{"line":1,"column":427}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":442}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":444}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":446}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":455}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":460}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":475}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":479}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":481}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":483}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":492}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":497}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":16,"column":39},"generated":{"line":1,"column":516}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":521}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":523}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":525}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":534}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":539}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":18,"column":38},"generated":{"line":1,"column":557}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":562}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":564}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":566}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":575}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":580}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":600}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":22,"column":4},"generated":{"line":1,"column":603}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":22,"column":9},"generated":{"line":1,"column":608}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":22,"column":19},"generated":{"line":1,"column":616}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":23,"column":4},"generated":{"line":1,"column":619}},{"source":"../../../src/lib/effect-manager.ts","name":"_needsRedraw","original":{"line":23,"column":9},"generated":{"line":1,"column":624}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":23,"column":24},"generated":{"line":1,"column":637}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":24,"column":4},"generated":{"line":1,"column":654}},{"source":"../../../src/lib/effect-manager.ts","name":"_setEffects","original":{"line":24,"column":9},"generated":{"line":1,"column":659}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":24,"column":21},"generated":{"line":1,"column":671}},{"source":"../../../src/lib/effect-manager.ts","name":"addDefaultEffect","original":{"line":30,"column":2},"generated":{"line":1,"column":675}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":30,"column":19},"generated":{"line":1,"column":692}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":31,"column":4},"generated":{"line":1,"column":695}},{"source":"../../../src/lib/effect-manager.ts","name":"defaultEffects","original":{"line":31,"column":10},"generated":{"line":1,"column":701}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":31,"column":27},"generated":{"line":1,"column":703}},{"source":"../../../src/lib/effect-manager.ts","name":"_defaultEffects","original":{"line":31,"column":32},"generated":{"line":1,"column":708}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":1,"column":724}},{"source":"../../../src/lib/effect-manager.ts","name":"defaultEffects","original":{"line":32,"column":9},"generated":{"line":1,"column":728}},{"source":"../../../src/lib/effect-manager.ts","name":"find","original":{"line":32,"column":24},"generated":{"line":1,"column":730}},{"source":"../../../src/lib/effect-manager.ts","name":"e","original":{"line":32,"column":29},"generated":{"line":1,"column":735}},{"source":"../../../src/lib/effect-manager.ts","name":"e","original":{"line":32,"column":34},"generated":{"line":1,"column":738}},{"source":"../../../src/lib/effect-manager.ts","name":"id","original":{"line":32,"column":36},"generated":{"line":1,"column":740}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":32,"column":43},"generated":{"line":1,"column":745}},{"source":"../../../src/lib/effect-manager.ts","name":"id","original":{"line":32,"column":50},"generated":{"line":1,"column":747}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":32,"column":55},"generated":{"line":1,"column":751}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":1,"column":752}},{"source":"../../../src/lib/effect-manager.ts","name":"index","original":{"line":33,"column":12},"generated":{"line":1,"column":758}},{"source":"../../../src/lib/effect-manager.ts","name":"defaultEffects","original":{"line":33,"column":20},"generated":{"line":1,"column":760}},{"source":"../../../src/lib/effect-manager.ts","name":"findIndex","original":{"line":33,"column":35},"generated":{"line":1,"column":762}},{"source":"../../../src/lib/effect-manager.ts","name":"e","original":{"line":33,"column":45},"generated":{"line":1,"column":772}},{"source":"../../../src/lib/effect-manager.ts","name":"compareEffects","original":{"line":33,"column":50},"generated":{"line":1,"column":775}},{"source":"../../../src/lib/effect-manager.ts","name":"e","original":{"line":33,"column":65},"generated":{"line":1,"column":777}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":33,"column":68},"generated":{"line":1,"column":779}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":33,"column":78},"generated":{"line":1,"column":782}},{"source":"../../../src/lib/effect-manager.ts","name":"index","original":{"line":34,"column":10},"generated":{"line":1,"column":785}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":34,"column":18},"generated":{"line":1,"column":787}},{"source":"../../../src/lib/effect-manager.ts","name":"defaultEffects","original":{"line":35,"column":8},"generated":{"line":1,"column":789}},{"source":"../../../src/lib/effect-manager.ts","name":"push","original":{"line":35,"column":23},"generated":{"line":1,"column":791}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":35,"column":28},"generated":{"line":1,"column":796}},{"source":"../../../src/lib/effect-manager.ts","name":"defaultEffects","original":{"line":37,"column":8},"generated":{"line":1,"column":799}},{"source":"../../../src/lib/effect-manager.ts","name":"splice","original":{"line":37,"column":23},"generated":{"line":1,"column":801}},{"source":"../../../src/lib/effect-manager.ts","name":"index","original":{"line":37,"column":30},"generated":{"line":1,"column":808}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":37,"column":37},"generated":{"line":1,"column":810}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":37,"column":40},"generated":{"line":1,"column":812}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":39,"column":6},"generated":{"line":1,"column":815}},{"source":"../../../src/lib/effect-manager.ts","name":"_setEffects","original":{"line":39,"column":11},"generated":{"line":1,"column":820}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":832}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":39,"column":28},"generated":{"line":1,"column":837}},{"source":"../../../src/lib/effect-manager.ts","name":"setProps","original":{"line":43,"column":2},"generated":{"line":1,"column":847}},{"source":"../../../src/lib/effect-manager.ts","name":"props","original":{"line":43,"column":11},"generated":{"line":1,"column":856}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":1,"column":859}},{"source":"../../../src/lib/effect-manager.ts","name":"props","original":{"line":44,"column":21},"generated":{"line":1,"column":871}},{"source":"../../../src/lib/effect-manager.ts","name":"deepEqual","original":{"line":46,"column":11},"generated":{"line":1,"column":876}},{"source":"../../../src/lib/effect-manager.ts","name":"deepEqual","original":{"line":46,"column":11},"generated":{"line":1,"column":878}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":46,"column":20},"generated":{"line":1,"column":880}},{"source":"../../../src/lib/effect-manager.ts","name":"props","original":{"line":46,"column":21},"generated":{"line":1,"column":891}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":46,"column":27},"generated":{"line":1,"column":893}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":46,"column":36},"generated":{"line":1,"column":901}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":46,"column":41},"generated":{"line":1,"column":906}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":46,"column":50},"generated":{"line":1,"column":914}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":47,"column":8},"generated":{"line":1,"column":918}},{"source":"../../../src/lib/effect-manager.ts","name":"_setEffects","original":{"line":47,"column":13},"generated":{"line":1,"column":923}},{"source":"../../../src/lib/effect-manager.ts","name":"props","original":{"line":47,"column":25},"generated":{"line":1,"column":935}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":47,"column":31},"generated":{"line":1,"column":937}},{"source":"../../../src/lib/effect-manager.ts","name":"needsRedraw","original":{"line":52,"column":2},"generated":{"line":1,"column":947}},{"source":"../../../src/lib/effect-manager.ts","name":"opts","original":{"line":52,"column":14},"generated":{"line":1,"column":959}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":52,"column":21},"generated":{"line":1,"column":961}},{"source":"../../../src/lib/effect-manager.ts","name":"clearRedrawFlags","original":{"line":52,"column":22},"generated":{"line":1,"column":962}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":52,"column":40},"generated":{"line":1,"column":980}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":53,"column":4},"generated":{"line":1,"column":984}},{"source":"../../../src/lib/effect-manager.ts","name":"redraw","original":{"line":53,"column":10},"generated":{"line":1,"column":990}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":53,"column":19},"generated":{"line":1,"column":992}},{"source":"../../../src/lib/effect-manager.ts","name":"_needsRedraw","original":{"line":53,"column":24},"generated":{"line":1,"column":997}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":57,"column":4},"generated":{"line":1,"column":1010}},{"source":"../../../src/lib/effect-manager.ts","name":"opts","original":{"line":54,"column":8},"generated":{"line":1,"column":1017}},{"source":"../../../src/lib/effect-manager.ts","name":"clearRedrawFlags","original":{"line":54,"column":13},"generated":{"line":1,"column":1019}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":1,"column":1038}},{"source":"../../../src/lib/effect-manager.ts","name":"_needsRedraw","original":{"line":55,"column":11},"generated":{"line":1,"column":1043}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":55,"column":26},"generated":{"line":1,"column":1057}},{"source":"../../../src/lib/effect-manager.ts","name":"redraw","original":{"line":57,"column":11},"generated":{"line":1,"column":1060}},{"source":"../../../src/lib/effect-manager.ts","name":"getEffects","original":{"line":60,"column":2},"generated":{"line":1,"column":1062}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":61,"column":4},"generated":{"line":1,"column":1075}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":61,"column":11},"generated":{"line":1,"column":1082}},{"source":"../../../src/lib/effect-manager.ts","name":"_resolvedEffects","original":{"line":61,"column":16},"generated":{"line":1,"column":1087}},{"source":"../../../src/lib/effect-manager.ts","name":"_setEffects","original":{"line":64,"column":10},"generated":{"line":1,"column":1104}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":64,"column":22},"generated":{"line":1,"column":1116}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":65,"column":4},"generated":{"line":1,"column":1119}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":65,"column":10},"generated":{"line":1,"column":1125}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":65,"column":50},"generated":{"line":1,"column":1127}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":66,"column":4},"generated":{"line":1,"column":1130}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":66,"column":9},"generated":{"line":1,"column":1134}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":66,"column":15},"generated":{"line":1,"column":1140}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":66,"column":25},"generated":{"line":1,"column":1145}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":66,"column":30},"generated":{"line":1,"column":1150}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":67,"column":6},"generated":{"line":1,"column":1158}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":67,"column":20},"generated":{"line":1,"column":1160}},{"source":"../../../src/lib/effect-manager.ts","name":"id","original":{"line":67,"column":27},"generated":{"line":1,"column":1162}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":67,"column":33},"generated":{"line":1,"column":1166}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":70,"column":4},"generated":{"line":1,"column":1168}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":70,"column":10},"generated":{"line":1,"column":1174}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":70,"column":34},"generated":{"line":1,"column":1176}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":1,"column":1179}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":1,"column":1183}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":71,"column":15},"generated":{"line":1,"column":1189}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":71,"column":25},"generated":{"line":1,"column":1194}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":71,"column":34},"generated":{"line":1,"column":1196}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":72,"column":6},"generated":{"line":1,"column":1197}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":72,"column":12},"generated":{"line":1,"column":1203}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":72,"column":24},"generated":{"line":1,"column":1205}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":72,"column":38},"generated":{"line":1,"column":1207}},{"source":"../../../src/lib/effect-manager.ts","name":"id","original":{"line":72,"column":45},"generated":{"line":1,"column":1209}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":73,"column":10},"generated":{"line":1,"column":1213}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":73,"column":23},"generated":{"line":1,"column":1216}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":73,"column":37},"generated":{"line":1,"column":1220}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":74,"column":12},"generated":{"line":1,"column":1222}},{"source":"../../../src/lib/effect-manager.ts","name":"setProps","original":{"line":74,"column":22},"generated":{"line":1,"column":1224}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":75,"column":10},"generated":{"line":1,"column":1234}},{"source":"../../../src/lib/effect-manager.ts","name":"setProps","original":{"line":75,"column":20},"generated":{"line":1,"column":1236}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":75,"column":29},"generated":{"line":1,"column":1245}},{"source":"../../../src/lib/effect-manager.ts","name":"props","original":{"line":75,"column":36},"generated":{"line":1,"column":1247}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":76,"column":10},"generated":{"line":1,"column":1254}},{"source":"../../../src/lib/effect-manager.ts","name":"push","original":{"line":76,"column":22},"generated":{"line":1,"column":1256}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":76,"column":27},"generated":{"line":1,"column":1261}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffect","original":{"line":78,"column":10},"generated":{"line":1,"column":1266}},{"source":"../../../src/lib/effect-manager.ts","name":"cleanup","original":{"line":78,"column":20},"generated":{"line":1,"column":1268}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":79,"column":10},"generated":{"line":1,"column":1278}},{"source":"../../../src/lib/effect-manager.ts","name":"push","original":{"line":79,"column":22},"generated":{"line":1,"column":1280}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":79,"column":27},"generated":{"line":1,"column":1285}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":82,"column":8},"generated":{"line":1,"column":1289}},{"source":"../../../src/lib/effect-manager.ts","name":"push","original":{"line":82,"column":20},"generated":{"line":1,"column":1291}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":82,"column":25},"generated":{"line":1,"column":1296}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":84,"column":13},"generated":{"line":1,"column":1306}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":84,"column":27},"generated":{"line":1,"column":1308}},{"source":"../../../src/lib/effect-manager.ts","name":"id","original":{"line":84,"column":34},"generated":{"line":1,"column":1310}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":1,"column":1314}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":86,"column":9},"generated":{"line":1,"column":1318}},{"source":"../../../src/lib/effect-manager.ts","name":"removedEffectId","original":{"line":86,"column":15},"generated":{"line":1,"column":1324}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":86,"column":34},"generated":{"line":1,"column":1329}},{"source":"../../../src/lib/effect-manager.ts","name":"oldEffectsMap","original":{"line":87,"column":6},"generated":{"line":1,"column":1331}},{"source":"../../../src/lib/effect-manager.ts","name":"removedEffectId","original":{"line":87,"column":20},"generated":{"line":1,"column":1333}},{"source":"../../../src/lib/effect-manager.ts","name":"cleanup","original":{"line":87,"column":37},"generated":{"line":1,"column":1336}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":89,"column":4},"generated":{"line":1,"column":1346}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":89,"column":9},"generated":{"line":1,"column":1351}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":89,"column":19},"generated":{"line":1,"column":1359}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":91,"column":4},"generated":{"line":1,"column":1361}},{"source":"../../../src/lib/effect-manager.ts","name":"_resolvedEffects","original":{"line":91,"column":9},"generated":{"line":1,"column":1366}},{"source":"../../../src/lib/effect-manager.ts","name":"nextEffects","original":{"line":91,"column":28},"generated":{"line":1,"column":1383}},{"source":"../../../src/lib/effect-manager.ts","name":"concat","original":{"line":91,"column":40},"generated":{"line":1,"column":1385}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":91,"column":47},"generated":{"line":1,"column":1392}},{"source":"../../../src/lib/effect-manager.ts","name":"_defaultEffects","original":{"line":91,"column":52},"generated":{"line":1,"column":1397}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":93,"column":9},"generated":{"line":1,"column":1414}},{"source":"../../../src/lib/effect-manager.ts","name":"some","original":{"line":93,"column":17},"generated":{"line":1,"column":1416}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":93,"column":22},"generated":{"line":1,"column":1421}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":93,"column":32},"generated":{"line":1,"column":1424}},{"source":"../../../src/lib/effect-manager.ts","name":"LightingEffect","original":{"line":93,"column":50},"generated":{"line":1,"column":1437}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":93,"column":9},"generated":{"line":1,"column":1439}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":94,"column":6},"generated":{"line":1,"column":1449}},{"source":"../../../src/lib/effect-manager.ts","name":"_resolvedEffects","original":{"line":94,"column":11},"generated":{"line":1,"column":1454}},{"source":"../../../src/lib/effect-manager.ts","name":"push","original":{"line":94,"column":28},"generated":{"line":1,"column":1471}},{"source":"../../../src/lib/effect-manager.ts","name":"DEFAULT_LIGHTING_EFFECT","original":{"line":94,"column":33},"generated":{"line":1,"column":1476}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":96,"column":4},"generated":{"line":1,"column":1479}},{"source":"../../../src/lib/effect-manager.ts","name":"_needsRedraw","original":{"line":96,"column":9},"generated":{"line":1,"column":1484}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":96,"column":24},"generated":{"line":1,"column":1497}},{"source":"../../../src/lib/effect-manager.ts","name":"finalize","original":{"line":99,"column":2},"generated":{"line":1,"column":1515}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":100,"column":4},"generated":{"line":1,"column":1526}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":100,"column":9},"generated":{"line":1,"column":1530}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":100,"column":15},"generated":{"line":1,"column":1536}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":100,"column":25},"generated":{"line":1,"column":1541}},{"source":"../../../src/lib/effect-manager.ts","name":"_resolvedEffects","original":{"line":100,"column":30},"generated":{"line":1,"column":1546}},{"source":"../../../src/lib/effect-manager.ts","name":"effect","original":{"line":101,"column":6},"generated":{"line":1,"column":1563}},{"source":"../../../src/lib/effect-manager.ts","name":"cleanup","original":{"line":101,"column":13},"generated":{"line":1,"column":1565}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":104,"column":4},"generated":{"line":1,"column":1575}},{"source":"../../../src/lib/effect-manager.ts","name":"effects","original":{"line":104,"column":9},"generated":{"line":1,"column":1580}},{"source":"../../../src/lib/effect-manager.ts","name":"length","original":{"line":104,"column":17},"generated":{"line":1,"column":1588}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":104,"column":26},"generated":{"line":1,"column":1595}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":105,"column":4},"generated":{"line":1,"column":1597}},{"source":"../../../src/lib/effect-manager.ts","name":"_resolvedEffects","original":{"line":105,"column":9},"generated":{"line":1,"column":1602}},{"source":"../../../src/lib/effect-manager.ts","name":"length","original":{"line":105,"column":26},"generated":{"line":1,"column":1619}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":105,"column":35},"generated":{"line":1,"column":1626}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":106,"column":4},"generated":{"line":1,"column":1628}},{"source":"../../../src/lib/effect-manager.ts","name":"_defaultEffects","original":{"line":106,"column":9},"generated":{"line":1,"column":1633}},{"source":"../../../src/lib/effect-manager.ts","name":"length","original":{"line":106,"column":25},"generated":{"line":1,"column":1649}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":106,"column":34},"generated":{"line":1,"column":1656}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":1659}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":1667}},{"source":"../../../src/lib/effect-manager.ts","name":null,"original":{"line":14,"column":35},"generated":{"line":1,"column":1675}}],"sources":{"../../../src/lib/effect-manager.ts":"import {deepEqual} from '../utils/deep-equal';\nimport LightingEffect from '../effects/lighting/lighting-effect';\nimport type {Effect} from './effect';\n\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\n\n/** Sort two effects. Returns 0 if equal, negative if e1 < e2, positive if e1 > e2 */\nfunction compareEffects(e1: Effect, e2: Effect): number {\n  const o1 = e1.order ?? Infinity;\n  const o2 = e2.order ?? Infinity;\n  return o1 - o2;\n}\n\nexport default class EffectManager {\n  effects: Effect[];\n  private _resolvedEffects: Effect[] = [];\n  /** Effect instances and order preference pairs, sorted by order */\n  private _defaultEffects: Effect[] = [];\n  private _needsRedraw: false | string;\n\n  constructor() {\n    this.effects = [];\n    this._needsRedraw = 'Initial render';\n    this._setEffects([]);\n  }\n\n  /**\n   * Register a new default effect, i.e. an effect presents regardless of user supplied props.effects\n   */\n  addDefaultEffect(effect: Effect) {\n    const defaultEffects = this._defaultEffects;\n    if (!defaultEffects.find(e => e.id === effect.id)) {\n      const index = defaultEffects.findIndex(e => compareEffects(e, effect) > 0);\n      if (index < 0) {\n        defaultEffects.push(effect);\n      } else {\n        defaultEffects.splice(index, 0, effect);\n      }\n      this._setEffects(this.effects);\n    }\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      // Compare effects against each other shallowly\n      if (!deepEqual(props.effects, this.effects, 1)) {\n        this._setEffects(props.effects);\n      }\n    }\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}): false | string {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  getEffects() {\n    return this._resolvedEffects;\n  }\n\n  private _setEffects(effects: Effect[]) {\n    const oldEffectsMap: Record<string, Effect> = {};\n    for (const effect of this.effects) {\n      oldEffectsMap[effect.id] = effect;\n    }\n\n    const nextEffects: Effect[] = [];\n    for (const effect of effects) {\n      const oldEffect = oldEffectsMap[effect.id];\n      if (oldEffect && oldEffect !== effect) {\n        if (oldEffect.setProps) {\n          oldEffect.setProps(effect.props);\n          nextEffects.push(oldEffect);\n        } else {\n          oldEffect.cleanup();\n          nextEffects.push(effect);\n        }\n      } else {\n        nextEffects.push(effect);\n      }\n      delete oldEffectsMap[effect.id];\n    }\n    for (const removedEffectId in oldEffectsMap) {\n      oldEffectsMap[removedEffectId].cleanup();\n    }\n    this.effects = nextEffects;\n\n    this._resolvedEffects = nextEffects.concat(this._defaultEffects);\n    // Special case for lighting: only add default instance if no LightingEffect is specified\n    if (!effects.some(effect => effect instanceof LightingEffect)) {\n      this._resolvedEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n    this._needsRedraw = 'effects changed';\n  }\n\n  finalize() {\n    for (const effect of this._resolvedEffects) {\n      effect.cleanup();\n    }\n\n    this.effects.length = 0;\n    this._resolvedEffects.length = 0;\n    this._defaultEffects.length = 0;\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"91424f8b3b368b9220133ac1c8cd5467","cacheData":{"env":{}}}