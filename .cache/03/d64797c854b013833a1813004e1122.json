{"id":"sL87","dependencies":[{"name":"/project/deck-gl-examples-01/node_modules/@loaders.gl/worker-utils/dist/esm/lib/worker-utils/get-loadable-worker-url.js.map","includedInParent":true,"mtime":1688284132508},{"name":"/project/deck-gl-examples-01/package.json","includedInParent":true,"mtime":1688495957541},{"name":"/project/deck-gl-examples-01/node_modules/@loaders.gl/worker-utils/package.json","includedInParent":true,"mtime":1688284132508},{"name":"../env-utils/assert","loc":{"line":1,"column":23,"index":23},"parent":"/project/deck-gl-examples-01/node_modules/@loaders.gl/worker-utils/dist/esm/lib/worker-utils/get-loadable-worker-url.js","resolved":"/project/deck-gl-examples-01/node_modules/@loaders.gl/worker-utils/dist/esm/lib/env-utils/assert.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.getLoadableWorkerURL=t;var r=require(\"../env-utils/assert\");const e=new Map;function t(t){(0,r.assert)(t.source&&!t.url||!t.source&&t.url);let s=e.get(t.source||t.url);return s||(t.url&&(s=o(t.url),e.set(t.url,s)),t.source&&(s=n(t.source),e.set(t.source,s))),(0,r.assert)(s),s}function o(r){if(!r.startsWith(\"http\"))return r;return n(s(r))}function n(r){const e=new Blob([r],{type:\"application/javascript\"});return URL.createObjectURL(e)}function s(r){return\"try {\\n  importScripts('\".concat(r,\"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}\")}"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":0}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":13}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":20}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":35}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":43}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":56}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":57}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":64}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":68}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":76}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":77,"column":0},"generated":{"line":1,"column":97}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":103}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":105}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":113}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":1,"column":136}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURLCache","original":{"line":3,"column":6},"generated":{"line":1,"column":142}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":3,"column":23},"generated":{"line":1,"column":144}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"Map","original":{"line":3,"column":27},"generated":{"line":1,"column":148}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":14,"column":7},"generated":{"line":1,"column":152}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURL","original":{"line":14,"column":16},"generated":{"line":1,"column":161}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":14,"column":37},"generated":{"line":1,"column":163}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"assert","original":{"line":15,"column":2},"generated":{"line":1,"column":167}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"assert","original":{"line":15,"column":2},"generated":{"line":1,"column":169}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":15,"column":8},"generated":{"line":1,"column":171}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":15,"column":10},"generated":{"line":1,"column":179}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":15,"column":16},"generated":{"line":1,"column":181}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":15,"column":27},"generated":{"line":1,"column":190}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":15,"column":33},"generated":{"line":1,"column":192}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":15,"column":43},"generated":{"line":1,"column":198}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":15,"column":49},"generated":{"line":1,"column":200}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":15,"column":59},"generated":{"line":1,"column":208}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":15,"column":65},"generated":{"line":1,"column":210}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":215}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":17,"column":6},"generated":{"line":1,"column":219}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURLCache","original":{"line":17,"column":18},"generated":{"line":1,"column":221}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"get","original":{"line":17,"column":33},"generated":{"line":1,"column":223}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":17,"column":37},"generated":{"line":1,"column":227}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":17,"column":43},"generated":{"line":1,"column":229}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":17,"column":53},"generated":{"line":1,"column":237}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":17,"column":59},"generated":{"line":1,"column":239}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":32,"column":2},"generated":{"line":1,"column":244}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":18,"column":7},"generated":{"line":1,"column":251}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":20,"column":8},"generated":{"line":1,"column":255}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":20,"column":14},"generated":{"line":1,"column":257}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":21,"column":6},"generated":{"line":1,"column":263}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURLFromURL","original":{"line":21,"column":18},"generated":{"line":1,"column":265}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":21,"column":46},"generated":{"line":1,"column":267}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":21,"column":52},"generated":{"line":1,"column":269}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURLCache","original":{"line":22,"column":6},"generated":{"line":1,"column":274}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"set","original":{"line":22,"column":21},"generated":{"line":1,"column":276}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":22,"column":25},"generated":{"line":1,"column":280}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":22,"column":31},"generated":{"line":1,"column":282}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":22,"column":36},"generated":{"line":1,"column":286}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":25,"column":8},"generated":{"line":1,"column":290}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":25,"column":14},"generated":{"line":1,"column":292}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":26,"column":6},"generated":{"line":1,"column":301}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURLFromSource","original":{"line":26,"column":18},"generated":{"line":1,"column":303}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":26,"column":49},"generated":{"line":1,"column":305}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":26,"column":55},"generated":{"line":1,"column":307}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURLCache","original":{"line":27,"column":6},"generated":{"line":1,"column":315}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"set","original":{"line":27,"column":21},"generated":{"line":1,"column":317}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"props","original":{"line":27,"column":25},"generated":{"line":1,"column":321}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"source","original":{"line":27,"column":31},"generated":{"line":1,"column":323}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":27,"column":39},"generated":{"line":1,"column":330}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"assert","original":{"line":31,"column":2},"generated":{"line":1,"column":336}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"assert","original":{"line":31,"column":2},"generated":{"line":1,"column":338}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":31,"column":8},"generated":{"line":1,"column":340}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":31,"column":9},"generated":{"line":1,"column":348}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerURL","original":{"line":32,"column":9},"generated":{"line":1,"column":351}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":40,"column":0},"generated":{"line":1,"column":353}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURLFromURL","original":{"line":40,"column":9},"generated":{"line":1,"column":362}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":40,"column":37},"generated":{"line":1,"column":364}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":42,"column":2},"generated":{"line":1,"column":367}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":42,"column":7},"generated":{"line":1,"column":371}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"startsWith","original":{"line":42,"column":11},"generated":{"line":1,"column":373}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":42,"column":22},"generated":{"line":1,"column":384}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":43,"column":4},"generated":{"line":1,"column":392}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":43,"column":11},"generated":{"line":1,"column":399}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":48,"column":2},"generated":{"line":1,"column":401}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURLFromSource","original":{"line":48,"column":9},"generated":{"line":1,"column":408}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"buildScriptSource","original":{"line":47,"column":23},"generated":{"line":1,"column":410}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"url","original":{"line":47,"column":41},"generated":{"line":1,"column":412}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":1,"column":416}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"getLoadableWorkerURLFromSource","original":{"line":56,"column":9},"generated":{"line":1,"column":425}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerSource","original":{"line":56,"column":40},"generated":{"line":1,"column":427}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":57,"column":2},"generated":{"line":1,"column":430}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"blob","original":{"line":57,"column":8},"generated":{"line":1,"column":436}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":57,"column":15},"generated":{"line":1,"column":438}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"Blob","original":{"line":57,"column":19},"generated":{"line":1,"column":442}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":57,"column":24},"generated":{"line":1,"column":447}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerSource","original":{"line":57,"column":25},"generated":{"line":1,"column":448}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":57,"column":40},"generated":{"line":1,"column":451}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"type","original":{"line":57,"column":41},"generated":{"line":1,"column":452}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":57,"column":47},"generated":{"line":1,"column":457}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":58,"column":2},"generated":{"line":1,"column":484}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"URL","original":{"line":58,"column":9},"generated":{"line":1,"column":491}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"createObjectURL","original":{"line":58,"column":13},"generated":{"line":1,"column":495}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"blob","original":{"line":58,"column":29},"generated":{"line":1,"column":511}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":69,"column":0},"generated":{"line":1,"column":514}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"buildScriptSource","original":{"line":69,"column":9},"generated":{"line":1,"column":523}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerUrl","original":{"line":69,"column":27},"generated":{"line":1,"column":525}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":1,"column":528}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":1,"column":534}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"concat","original":{"line":70,"column":2},"generated":{"line":1,"column":561}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":"workerUrl","original":{"line":72,"column":19},"generated":{"line":1,"column":568}},{"source":"../../../../src/lib/worker-utils/get-loadable-worker-url.ts","name":null,"original":{"line":72,"column":28},"generated":{"line":1,"column":570}}],"sources":{"../../../../src/lib/worker-utils/get-loadable-worker-url.ts":"import {assert} from '../env-utils/assert';\n\nconst workerURLCache = new Map();\n\n/**\n * Creates a loadable URL from worker source or URL\n * that can be used to create `Worker` instances.\n * Due to CORS issues it may be necessary to wrap a URL in a small importScripts\n * @param props\n * @param props.source Worker source\n * @param props.url Worker URL\n * @returns loadable url\n */\nexport function getLoadableWorkerURL(props: {source?: string; url?: string}) {\n  assert((props.source && !props.url) || (!props.source && props.url)); // Either source or url must be defined\n\n  let workerURL = workerURLCache.get(props.source || props.url);\n  if (!workerURL) {\n    // Differentiate worker urls from worker source code\n    if (props.url) {\n      workerURL = getLoadableWorkerURLFromURL(props.url);\n      workerURLCache.set(props.url, workerURL);\n    }\n\n    if (props.source) {\n      workerURL = getLoadableWorkerURLFromSource(props.source);\n      workerURLCache.set(props.source, workerURL);\n    }\n  }\n\n  assert(workerURL);\n  return workerURL;\n}\n\n/**\n * Build a loadable worker URL from worker URL\n * @param url\n * @returns loadable URL\n */\nfunction getLoadableWorkerURLFromURL(url: string): string {\n  // A local script url, we can use it to initialize a Worker directly\n  if (!url.startsWith('http')) {\n    return url;\n  }\n\n  // A remote script, we need to use `importScripts` to load from different origin\n  const workerSource = buildScriptSource(url);\n  return getLoadableWorkerURLFromSource(workerSource);\n}\n\n/**\n * Build a loadable worker URL from worker source\n * @param workerSource\n * @returns loadable url\n */\nfunction getLoadableWorkerURLFromSource(workerSource: string): string {\n  const blob = new Blob([workerSource], {type: 'application/javascript'});\n  return URL.createObjectURL(blob);\n}\n\n/**\n * Per spec, worker cannot be initialized with a script from a different origin\n * However a local worker script can still import scripts from other origins,\n * so we simply build a wrapper script.\n *\n * @param workerUrl\n * @returns source\n */\nfunction buildScriptSource(workerUrl: string): string {\n  return `\\\ntry {\n  importScripts('${workerUrl}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`;\n}\n"},"lineCount":null}},"error":null,"hash":"55fb54fa3a4b51a21d0f9985beb32ef0","cacheData":{"env":{}}}